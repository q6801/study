# IP 프로토콜 (network layer)
- [네트워크 계층의 기능](#네트워크-계층의-기능)
- [용어들](#용어들)
- [IP 프로토콜](#ip-프로토콜)
- [AS (Automonous System)](#as-automonous-system)
- [Intra AS 라우팅 프로토콜](#intra-as-라우팅-프로토콜)
- [참고](#참고)

</br>

# 네트워크 계층의 기능

- 데이터 링크 계층에서는 이더넷 규칙을  기반으로 같은 네트워크에 있는 컴퓨터로는 데이터를 전송할 수 있다.
    - 하지만 인터넷이나 다른 네트워크로 데이터 전송이 불가능하다. == 다른 네트워크에 있는 목적지로 데이터를 전달하려면 네트워크 계층의 기술이 필요하다.
- 데이터 패킷이 **목적지까지 최적의 경로를 선택하게 배정**하는 기능
- 데이터 링크 계층에서는 이더넷 규칙을 기반으로 같은 네트워크에 있는 컴퓨터로는 데이터를 전송할 수 있지만, 인터넷이나 다른 네트워크로는 데이터를 전송할 수 없다.

</br>

# 용어들

라우터

- 서로 다른 네트워크를 연결해 주는 장치
- 라우터는 데이터의 목적지가 정해지면 해당 목적지까지 어떤 경로로 가는 것이 좋은지를 알려주는 기능을 함

라우팅

- 네트워크에서 패킷을 목적지로 보낼 때 목적지까지 갈 수 있는 여러 가지 경로 중 한 가지 경로를 설정해 주는 과정

라우팅 테이블

- 다른 네트워크로 가기 위해 가장 적합한 라우터에 관한 테이블이다.
- 즉, 네트워크상의 특정 목적지까지의 거리와 가는 방법등을 명시하고 있는 테이블이다.

MAC 주소

- 컴퓨터간 데이터를 전송하기 위해 있는 컴퓨터의 **물리적 주소**
- 같은 네트워크 안에서는 MAC 주소만으로 통신이 가능하지만 서로 다른 네트워크라면 각 네트워크를 식별하고 연결할 수 있어야한다.
- 그래서 각 **네트워크를 식별**할 수 있는 논리 주소인 IP 주소가 필요에 의해 사용된다.

IP 주소

- 컴퓨터 네트워크에서 장치들이 서로를 인식하고 통신하기 위해 사용하는 주소다.
- IP 주소는 인터넷 서비스 제공자(ISP)에게 받을 수 있음
- **네트워크 주소**
    - 전체 네트워크에서 **작은 네트워크**
    를 식별하는 데 사용되고, 호스트 ID가 10진수로 0이면 **그 네트워크 전체를 대표하는 주소**가 되는 것이다.
- **브로드캐스트 주소**
    - 네트워크에 있는 컴퓨터나 장비 모두에게 **한 번에 데이터를 전송**하는 데 사용되는 전용 IP 주소다.

MTU (maximum transmission unit)

- network layer에서 보낼 수 있는 최대의 payload 크기이다.
- payload 크기니까 header 크기는 제외

</br>

# IP 프로토콜

- 다른 layer들과 다르게 network layer는 IP 프로토콜이 거의 유일하다.
- 캡슐화할 때 출발지 IP 주소와 목적지 IP 주소를 IP 헤더로 붙인다. (물론 그 외에도 이것저것 붙임)
- **특징**
    - **비신뢰성** : IP 프로토콜이 전송하는 데이터가 정확하게 갔는지 확인하지 않는 것
    - **비연결성** : 송신자와 수신자가 데이터 전송을 위해 서로 연결될 필요가 없다. (일방적으로 걍 전송함)
    - 즉, 신뢰성있는 통신을 하기 위해서는 상위 레이어의 TCP와 같은 프로토콜을 활용해야한다.

</br>

### IP fragmentation

- IP 패킷 (datagram)은 다양한 라우터들을 거쳐 전송된다.
- 전송되는 과정에서 중간에 작은 크기의 link를 지날 수 있기 때문에 datagram의 파편화가 필요하다.
- 파편화된 datagram들은 목적지 host에 모두 도착하고 나서야 다시 합쳐진다.
    - fragmentation이 진행될 때마다 IP 헤더를 위해 20bytes씩 추가된다.
- ip헤더의 identifier로 파편화된 datagram이 같은 덩어리인지 식별하고 offset으로 순서를 맞춘다.


</br>


# AS (Automonous System)

- 단일한 라우팅 프로토콜을 사용하는 라우터들로 이루어진 영역을 의미한다.
- 인터넷에서 독립적인 라우팅 도메인을 뜻한다.
- AS의 경계에 있어서 관문 역할을 하는 라우터를 **게이트웨이**라고 함
- AS 내부를 연결하는 것이 Intra AS Protocol임
    - AS 내에서 각 라우터들은 AS 내부 정보들을 자신의 이웃한 라우터들끼리 공유한다.
    - 그래서 AS 내의 특정 네트워크까지 갈 수 있는 최단 경로에 대한 정보를 얻는다.
    - 그 방법으로는 RIP, OSPF 등이 있다.

</br>

# Intra AS 라우팅 프로토콜

### RIP

- 인터넷 초기에 선택한 프로토콜
- 거리벡터 알고리즘을 더 간단하게 만듦
    - 모든 링크 비용은 1
    - 갱신되지 않아도 30초마다 내 라우팅 정보를 이웃 라우터에 전달 → 빠르게 정보를 전달하기 위해
    - 최대 경로 비용이 15 → 최대 길이가 라우터 15개를 거치는 것
- 문제점
    - 과도한 rip 라우팅 트래픽
    - 링크가 다 1이라서 차등화된 링크 비용 설정 불가능

### OSPF (open shortest path first)

- 링크상태라우팅(다익스트라)을 적용함
- **내가 알고있는 네트워크 상태정보를 다른 라우터에 준다 (브로드 캐스팅)**
    - 그래서 네트워크 그래프를 모든 라우터가 그릴 수 있다.

</br>

# 참고
[[네트워크] 네트워크 계층](https://velog.io/@gndan4/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EA%B3%84%EC%B8%B5)

[IP 프로토콜 (IP header, fragmentation)](https://ddongwon.tistory.com/89)